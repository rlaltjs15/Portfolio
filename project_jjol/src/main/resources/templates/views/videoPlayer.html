<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JJOL EDU</title>

<link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<script src="/bootstrap/js/bootstrap.bundle.min.js"></script>

<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
	rel="stylesheet">
<link href="/css/styles.css" rel="stylesheet">

<link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
<script src="//vjs.zencdn.net/7.10.2/video.min.js"></script>

<script src="/js/jquery-3.7.1.min.js"></script>

<script
	src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />

<style>
body {
	margin: 0;
	padding: 0;
	display: flex;
	flex-direction: column;
	height: 100vh;
	font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.main-content {
	display: grid;
	grid-template-columns: 3fr 0fr;
	grid-template-rows: auto 1fr;
	width: 100%;
	height: 100%;
	transition: grid-template-columns 0.3s ease;
}

.navbar {
	grid-column: 1/-1;
}

.video-section {
	display: flex;
	justify-content: center;
	align-items: center;
	height: 100%;
	overflow: hidden;
	background-color: #0C1844;
}

video {
	width: 100%;
	height: 100%;
	object-fit: contain;
}

.right-column {
	height: 100%;
	display: none;
	flex-direction: column;
	padding: 20px;
	overflow-y: auto;
	background-color: #f1f3f5;
	border-left: 1px solid #ccc;
	width: calc(100% - 80px); /* ì•„ì´ì½˜ ë²„íŠ¼ì˜ ë„ˆë¹„ë¥¼ ê³ ë ¤í•˜ì—¬ ì˜¤ë¥¸ìª½ íŒ¨ë„ì˜ ë„ˆë¹„ë¥¼ ì¡°ì • */
	transition: transform 0.3s ease;
}

.right-column.show {
	display: flex;
	transform: translateX(0);
}

.content-section {
	display: none;
	opacity: 0;
	transition: opacity 0.3s ease;
}

.content-section.active {
	display: block;
	opacity: 1;
}

/* ì•„ì´ì½˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
.icon-buttons {
	position: fixed;
	top: 56px;
	right: 0;
	width: 80px; /* ë„“ì´ë¥¼ ë„“í˜ */
	height: calc(100% - 56px);
	display: flex;
	flex-direction: column;
	align-items: center;
	background-color: #f8f9fa;
	border-left: 1px solid #ccc;
	padding: 10px 0;
	z-index: 1000;
}

.icon-buttons div {
	display: flex;
	justify-content: center;
	align-items: center;
	width: 60px;
	height: 60px;
	margin: 10px 0;
	cursor: pointer;
	font-size: 24px; /* ì•„ì´ì½˜ í¬ê¸° ì¦ê°€ */
	color: #0C1844; /* ìƒ‰ìƒ ë³€ê²½ */
	background-color: #fff;
	border-radius: 8px; /* ì›ì—ì„œ ì‚¬ê°í˜•ìœ¼ë¡œ ë³€ê²½ */
	transition: background-color 0.3s, color 0.3s;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.icon-buttons div:hover {
	background-color: #e9ecef;
	color: #007bff;
}

.icon-buttons i {
	font-size: 24px;
}

.section-title {
	font-weight: bold;
	margin-top: 20px;
	color: #0C1844;
}

.lecture {
	display: flex;
	justify-content: space-between;
	padding: 10px 0;
	border-bottom: 1px solid #ccc;
	cursor: pointer;
	transition: background-color 0.3s ease;
}

.lecture:hover {
	background-color: #e9ecef;
}

.lecture-title {
	flex: 1;
	font-size: 16px;
	color: #0C1844;
}

.lecture-duration {
	width: 50px;
	text-align: right;
}

.lecture-inform, .note, .community {
	padding: 20px;
	background-color: #fff;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	margin-bottom: 20px;
}

.note-list, .community-list {
    margin-top: 10px;
    display: flex;
    flex-direction: column; /* ìˆ˜ì§ ì •ë ¬ì„ ìœ„í•´ ìˆ˜ì • */
    justify-content: flex-start; /* ìƒë‹¨ë¶€í„° ì •ë ¬ */
    color: #888; /* ìƒ‰ìƒ ë³€ê²½ */
    font-size: 16px; /* ê¸€ì”¨ í¬ê¸° ì¡°ì • */
}

.note-item, .community-item {
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 10px; /* ë¦¬ìŠ¤íŠ¸ ê°„ê²© ì¡°ì • */
    padding: 15px;
    background-color: #fff;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.note-item:hover, .community-item:hover {
    background-color: #f1f1f1;
}

.note-header, .community-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.note-title, .community-title {
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    color: #0C1844;
    margin: 0;
}

.note-content, .community-content {
    margin-top: 10px;
    display: none;
    font-size: 16px;
    color: #333;
}

.note-date, .community-meta {
    font-size: 14px;
    color: #888;
    margin-top: 10px;
}

.delete-note-button, .delete-community-button {
    background: transparent;
    border: none;
    color: #0C1844;
    cursor: pointer;
    transition: color 0.3s;
}

.delete-note-button:hover i, .delete-community-button:hover i {
    color: #e74c3c;
}

#noteTitle, #noteContent, #postTitle, #postContent {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 100%;
    font-size: 14px;
}

#saveNoteButton, #savePostButton {
    background-color: transparent;
    border: 2px solid #0C1844;
    padding: 10px 20px;
    color: #0C1844;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
}

#saveNoteButton:hover, #savePostButton:hover {
    background-color: #0C1844;
    color: white;
}

.curriculum h2, .note h2, .community h2 {
    color: #0C1844;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
}

.error-message {
    color: red;
    font-size: 12px;
    margin-top: 5px;
}

</style>
</head>
<body th:data-lecture-id="${lecture.lectureId}">
	<div class="icon-buttons">
		<div id="curriculumButton">
			<i class="fas fa-list"></i>
		</div>
		<div id="noteButton">
			<i class="fas fa-book"></i>
		</div>
		<div id="communityButton">
			<i class="fas fa-comments"></i>
		</div>
	</div>

	<div class="main-content" id="mainContent">
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand ms-5" href="/">JJol</a>
			<div class="collapse navbar-collapse">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a class="nav-link ms-5" href="javascript:history.back()">ê°•ì˜ ì •ë³´</a></li>
				</ul>
			</div>
		</nav>
		<div class="video-section">
			<video id="my-video" class="vjs-matrix video-js" controls
				preload="auto"
				data-setup='{"playbackRates": [2, 1.5, 1.25, 1, 0.75, 0.5]}'
				autoplay>
				<source id="video-source" th:src="@{${firstChapterUrl}}"
					type="video/mp4">
				<p class="vjs-no-js">ì´ ê°•ì˜ë¥¼ ë³´ë ¤ë©´ JavaScriptë¥¼ í™œì„±í™”í•˜ê³  ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì—…ê·¸ë ˆì´ë“œí•´ì•¼
					í•  ê²ƒ ê°™ì•„ìš”!!</p>
			</video>
		</div>
		<div class="right-column" id="rightColumn">
			<div id="curriculum" class="content-section curriculum">
				<div class="lecture-inform">
					<h2 class="my-3">ğŸ“š ê°•ì˜ ì†Œê°œ</h2>
					<div class="lecture-title mb-3">
						<h4 th:text="${lecture.lectureTitle}">ê°•ì˜ ì œëª©</h4>
					</div>
					<div class="lecture-teacher">
						<h5 th:text="'ê°•ì‚¬ : ' + ${lecture.instructorName}">ê°•ì‚¬</h5>
					</div>
					<div class="lecture-teacher">
						<h5 id="progress-info">ì§„ë„ìœ¨ : 0%</h5>
					</div>
					<div class="lecture-teacher">
						<h5 id="current-time-display">ì‹œê°„ : 0ë¶„/0ë¶„</h5>
					</div>
					<div></div>

					<div class="lecture-progress">
						<div></div>
						<div class="progress" role="progressbar"
							aria-label="lecture-progress" aria-valuenow="0" aria-valuemin="0"
							aria-valuemax="100">
							<div id="progress-bar" class="progress-bar w-0"></div>
						</div>
					</div>
				</div>

				<div class="lecture-sections" th:each="chapter : ${chapters}">
					<div class="section-title"
						th:text="'ì±•í„° ' + ${chapter.chapterOrder} + ': ' + ${chapter.chapterTitle}">ì„¹ì…˜
						ì œëª©</div>
					<div class="lecture" th:data-chapter-id="${chapter.chapterId}"
						th:data-url="${chapter.chapterUrl}"
						th:data-chapter-order="${chapter.chapterOrder}">
						<span class="lecture-title" th:text="${chapter.chapterTitle}">ê°•ì˜
							ì œëª©</span>
					</div>
				</div>
			</div>
			<div id="note" class="content-section">
				<h2>ğŸ“š í•™ìŠµ ë…¸íŠ¸</h2>
				<hr>
				<div id="noteList" class="note-list">
					<div th:each="note : ${notes}">
						<div class="note-item">
							<div class="note-header">
								<p th:text="${note.noteTitle}" class="note-title"
									onclick="toggleNoteContent(this)">ë…¸íŠ¸ ì œëª©</p>
								<button class="btn btn-danger btn-sm delete-note-button"
									th:data-note-id="${note.noteId}">ì‚­ì œ</button>
							</div>
							<div class="note-content" style="display: none;">
								<p th:text="${note.noteContent}">ë…¸íŠ¸ ë‚´ìš©</p>
							</div>
							<p class="note-date"
								th:text="${#dates.format(note.createdAt, 'yyyy-MM-dd HH:mm:ss')}">ì‘ì„±
								ì‹œê°„</p>
						</div>
					</div>
				</div>
				<hr>
				<div class="form-group">
					<label for="noteTitle">ë…¸íŠ¸ ì œëª©</label> <input type="text"
						id="noteTitle" class="form-control">
					<div id="noteTitleError" class="error-message"></div>
					<!-- ìœ íš¨ì„± ê²€ì‚¬ ë©”ì‹œì§€ ì¶”ê°€ -->
				</div>
				<div class="form-group">
					<label for="noteContent">ë…¸íŠ¸ ì‘ì„±</label>
					<textarea id="noteContent" class="form-control"></textarea>
					<div id="noteContentError" class="error-message"></div>
					<!-- ìœ íš¨ì„± ê²€ì‚¬ ë©”ì‹œì§€ ì¶”ê°€ -->
				</div>
				<div class="text-end">
					<button id="saveNoteButton" class="btn btn-outline-primary">ì €ì¥</button>
				</div>
			</div>
			<div id="community" class="content-section">
				<h2>ğŸ’¬ ì»¤ë®¤ë‹ˆí‹°</h2>
				<hr>
				<div id="communityList" class="community-list">
					<!-- ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
				</div>
				<hr>
				<div class="form-group">
					<label for="postTitle">ê²Œì‹œë¬¼ ì œëª©</label> <input type="text"
						id="postTitle" class="form-control">
					<div id="postTitleError" class="error-message"></div>
					<!-- ìœ íš¨ì„± ê²€ì‚¬ ë©”ì‹œì§€ ì¶”ê°€ -->
				</div>
				<div class="form-group">
					<label for="postContent">ê²Œì‹œë¬¼ ë‚´ìš©</label>
					<textarea id="postContent" class="form-control"></textarea>
					<div id="postContentError" class="error-message"></div>
					<!-- ìœ íš¨ì„± ê²€ì‚¬ ë©”ì‹œì§€ ì¶”ê°€ -->
				</div>
				<div class="text-end">
					<button id="savePostButton" class="btn btn-outline-primary">ì €ì¥</button>
				</div>


			</div>
		</div>
	</div>

	<script>
//ë…¸íŠ¸ì˜ ë‚´ìš©ì„ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
function toggleNoteContent(element) {
    $(element).closest('.note-item').find('.note-content').toggle();
}

// ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ì˜ ë‚´ìš©ì„ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
function toggleCommunityContent(element) {
    $(element).closest('.community-item').find('.community-content').toggle();
}

// DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
document.addEventListener("DOMContentLoaded", function() {
    const lectureId = document.body.getAttribute("data-lecture-id"); // í˜„ì¬ ê°•ì˜ ID
    let currentChapterOrder = 1; // ì´ˆê¸° ì±•í„° ìˆœì„œ
    let player; // ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ê°ì²´
    const totalChapters = document.querySelectorAll('.lecture').length; // ì „ì²´ ì±•í„° ìˆ˜

    // íŠ¹ì • ê°•ì˜ì™€ ì±•í„°ì˜ ë§ˆì§€ë§‰ ì‹œì²­ ì‹œê°„ê³¼ ì „ì²´ ê¸¸ì´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchLastViewedTimeAndDuration(lectureId, chapterId) {
        try {
            const response = await fetch(`/lecturePage/${lectureId}/${chapterId}`);
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            const data = await response.json();
            console.log("Fetched data:", data);  // ë””ë²„ê·¸ ë©”ì‹œì§€ ì¶”ê°€
            if (!data.lecturePage) {
                throw new Error("Invalid JSON structure");
            }
            return { startTime: data.lecturePage.startTime ?? 0, duration: data.lecturePage.duration ?? 0 };
        } catch (error) {
            console.error("fetch ì‘ì—…ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
            return { startTime: 0, duration: 0 };
        }
    }
    
 	// íŠ¹ì • ê°•ì˜ì˜ ë§ˆì§€ë§‰ ì‹œì²­í•œ ì±•í„°ì™€ ì‹œì²­ ì‹œê°„ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchLastViewedTimeAndChapter(lectureId) {
        try {
            const response = await fetch(`/lecturePage/${lectureId}/lastViewed`);
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            const data = await response.json();
            console.log("ë°ì´í„° ì •ìƒ");
            return { lastChapterOrder: data.chapterOrder ?? 1, startTime: data.startTime ?? 0 };
        } catch (error) {
            console.error("fetch ì‘ì—…ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
            return { lastChapterOrder: 1, startTime: 0 };
        }
    }



 // í˜„ì¬ ì‹œì²­ ì‹œê°„ì„ ì„œë²„ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    async function saveCurrentTime(lectureId, chapterId, currentTime, currentChapterOrder) {
        try {
            const response = await fetch('/lecturePage/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    lectureId: lectureId,
                    chapterId: chapterId,
                    startTime: currentTime,
                    lastChapterOrder: currentChapterOrder // ì¶”ê°€ëœ íŒŒë¼ë¯¸í„°
                })
            });
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
        } catch (error) {
            console.error("There was a problem with the save operation:", error);
        }
    }

    // ê°•ì˜ì˜ ì‹œì²­ ì§„í–‰ ìƒí™©ì„ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    async function resetLectureProgress(lectureId) {
        try {
            const response = await fetch(`/lecturePage/reset/${lectureId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
        } catch (error) {
            console.error("There was a problem with the reset operation:", error);
        }
    }

 	// ì§„í–‰ ë°”ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateProgressBar() {
        let progressPercentage = ((currentChapterOrder) / totalChapters) * 100;
        if (currentChapterOrder === totalChapters) {
            progressPercentage = 100; // ë§ˆì§€ë§‰ ì±•í„°ê°€ ëë‚˜ë©´ 100%ë¡œ ì„¤ì •
        }
        console.log("Updating progress bar:", progressPercentage); // ì½˜ì†” ë¡œê·¸ ì¶”ê°€
        document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
        document.getElementById('progress-info').innerText = `ì§„ë„ìœ¨ : ${Math.round(progressPercentage)}%`;
    }

    // ì‹œê°„ì„ í¬ë§·íŒ…í•˜ëŠ” í•¨ìˆ˜ (ì´ˆë¥¼ ì‹œ:ë¶„:ì´ˆ í˜•íƒœë¡œ ë³€í™˜)
    function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = Math.floor(seconds % 60);
        return `${h}:${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
    }

    // ê°•ì˜ì˜ ì´ ê¸¸ì´ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
    async function calculateTotalDuration() {
        let totalDuration = 0;
        for (let chapter of document.querySelectorAll('.lecture')) {
            const chapterId = chapter.getAttribute('data-chapter-id');
            const { duration } = await fetchLastViewedTimeAndDuration(lectureId, chapterId);
            totalDuration += duration;
        }
        return totalDuration;
    }

 	// í˜„ì¬ ì‹œì²­ ì‹œê°„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateCurrentTimeDisplay(currentTime, totalDuration) {
        const currentChapterDisplay = `ê°•ì˜ : ${currentChapterOrder} / ${totalChapters}`;
        console.log("Updating current time display:", currentChapterDisplay); // ì½˜ì†” ë¡œê·¸ ì¶”ê°€
        document.getElementById('current-time-display').innerText = `${currentChapterDisplay}`;
    }

    // ëª¨ë“  ì±•í„°ì˜ ì‹œì²­ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    async function resetAllChapters(lectureId) {
        try {
            const response = await fetch(`/lecturePage/reset/${lectureId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            const data = await response.json(); // JSON ì‘ë‹µ ì²˜ë¦¬
            if (data.status !== "success") {
                throw new Error("Failed to reset chapters");
            }
        } catch (error) {
            console.error("There was a problem with the reset operation:", error);
        }
    }

 // ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    async function initializePlayer() {
        if (!player) {
            player = videojs('my-video', {
                controls: true,
                autoplay: false,
                preload: 'auto'
            });

            const { lastChapterOrder, startTime } = await fetchLastViewedTimeAndChapter(lectureId);

            console.log(lastChapterOrder);

            if (startTime > 0) {
                const resumeFromLastTime = confirm("ë§ˆì§€ë§‰ ì‹œì²­ ì§€ì ë¶€í„° ì¬ìƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                if (resumeFromLastTime) {
                    currentChapterOrder = lastChapterOrder;
                    loadChapter(currentChapterOrder, startTime);
                } else {
                    await resetLectureProgress(lectureId);
                    loadChapter(1, 0);
                }
            } else {
                loadChapter(1, 0);
            }

            player.on('timeupdate', function() {
                const currentTime = player.currentTime();
                const chapterElement = document.querySelector(`.lecture[data-chapter-order="${currentChapterOrder}"]`);
                const chapterId = chapterElement.getAttribute('data-chapter-id');
                saveCurrentTime(lectureId, chapterId, currentTime, currentChapterOrder);
                updateCurrentTimeDisplay(currentTime, player.duration());
                updateProgressBar();
            });

            player.on('ended', function() {
                currentChapterOrder++;
                if (currentChapterOrder > totalChapters) {
                    currentChapterOrder = totalChapters;
                } else {
                    loadChapter(currentChapterOrder, 0);
                }
                updateProgressBar();
            });
            updateProgressBar();
            const { startTime: totalDuration } = await calculateTotalDuration();
            updateCurrentTimeDisplay(player.currentTime(), totalDuration); 
        }
    }

 // íŠ¹ì • ì±•í„°ë¥¼ ë¡œë“œí•˜ê³  ì‹œì‘ ì‹œê°„ì„ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
    async function loadChapter(chapterOrder, startTime) {
        const chapterElement = document.querySelector(`.lecture[data-chapter-order="${chapterOrder}"]`);
        if (!chapterElement) {
            console.error(`Chapter element with order ${chapterOrder} not found`);
            return;
        }
        const videoUrl = chapterElement.getAttribute('data-url');
        player.src({ type: 'video/mp4', src: videoUrl });
        player.ready(function() {
            player.currentTime(startTime);
            player.play();
        });
    }

    // ê° ì±•í„° ìš”ì†Œì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
    document.querySelectorAll('.lecture').forEach(function(lectureElement) {
        lectureElement.addEventListener('click', function() {
            currentChapterOrder = parseInt(this.getAttribute('data-chapter-order'));
            loadChapter(currentChapterOrder);
        });
    });

 // ì„¹ì…˜ í† ê¸€ í•¨ìˆ˜ ìˆ˜ì •
    function toggleSection(sectionId) {
        const mainContent = $('#mainContent');
        const rightColumn = $('#rightColumn');
        const sections = $('.content-section');
        const activeSection = $(`#${sectionId}`);

        if (activeSection.hasClass('active')) {
            activeSection.removeClass('active');
            rightColumn.removeClass('show'); // 'show' í´ë˜ìŠ¤ ì œê±°
            mainContent.css('grid-template-columns', '3fr 0fr');
        } else {
            sections.removeClass('active');
            activeSection.addClass('active');
            rightColumn.addClass('show'); // 'show' í´ë˜ìŠ¤ ì¶”ê°€
            mainContent.css('grid-template-columns', '3fr 1fr'); // ì˜¤ë¥¸ìª½ íŒ¨ë„ì„ í¬í•¨í•˜ë„ë¡ ì¡°ì •
        }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    $('#curriculumButton').click(function() {
        toggleSection('curriculum');
    });

    $('#noteButton').click(function() {
        toggleSection('note');
        loadNotes();
    });

    $('#communityButton').click(function() {
        toggleSection('community');
        loadLectureCommunities();
    });

 // ë…¸íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
    function loadNotes() {
        $.get(`/notes/${lectureId}`, function(notes) {
            $('#noteList').empty();
            if (notes.length === 0) {
                $('#noteList').append('<div>ì‘ì„±ëœ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
            } else {
                notes.forEach(note => {
                    $('#noteList').append(
                        `<div class="note-item" data-note-id="${note.noteId}">
                            <div class="note-header">
                                <p class="note-title" onclick="toggleNoteContent(this)">${note.noteTitle}</p>
                                <button class="delete-note-button" data-note-id="${note.noteId}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="note-content" style="display: none;">
                                <p>${note.noteContent}</p>
                            </div>
                            <p class="note-date">${new Date(note.createdAt).toLocaleDateString('ko-KR')} ${new Date(note.createdAt).toLocaleTimeString('ko-KR')}</p>
                        </div>`
                    );
                });
            }
        });
    }

 // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ì„ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
    function loadLectureCommunities() {
        $.get(`/community/${lectureId}`, function(posts) {
            $('#communityList').empty();
            if (posts.length === 0) {
                $('#communityList').append('<div>ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>');
            } else {
                posts.forEach(post => {
                    $('#communityList').append(
                        `<div class="community-item" data-post-id="${post.postId}">
                            <div class="community-header">
                                <p class="community-title" onclick="toggleCommunityContent(this)">${post.postTitle}</p>
                                <button class="delete-community-button" data-post-id="${post.postId}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="community-content" style="display: none;">
                                <p>${post.postContent}</p>
                            </div>
                            <p class="community-meta">${new Date(post.createdAt).toLocaleDateString('ko-KR')} ${new Date(post.createdAt).toLocaleTimeString('ko-KR')}</p>
                        </div>`
                    );
                });
            }
        });
    }

 // ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
    function validateInput(input, errorElement, message) {
        if (input.val().trim() === '') {
            errorElement.text(message);
            return false;
        } else {
            errorElement.text('');
            return true;
        }
    }

    // ë…¸íŠ¸ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $('#saveNoteButton').click(function() {
        const noteTitle = $('#noteTitle');
        const noteContent = $('#noteContent');
        const noteTitleError = $('#noteTitleError');
        const noteContentError = $('#noteContentError');

        const isTitleValid = validateInput(noteTitle, noteTitleError, 'ë…¸íŠ¸ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        const isContentValid = validateInput(noteContent, noteContentError, 'ë…¸íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

        if (isTitleValid && isContentValid) {
            $.post('/notes/add', { lectureId, noteTitle: noteTitle.val(), noteContent: noteContent.val() })
                .done(function(response) {
                    if (response === 'success') {
                        loadNotes();
                        noteTitle.val('');
                        noteContent.val('');
                    }
                })
                .fail(function(xhr) {
                    if (xhr.status === 403) {
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/login';
                    }
                });
        }
    });

 // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $('#savePostButton').click(function() {
        const postTitle = $('#postTitle');
        const postContent = $('#postContent');
        const postTitleError = $('#postTitleError');
        const postContentError = $('#postContentError');

        const isTitleValid = validateInput(postTitle, postTitleError, 'ê²Œì‹œë¬¼ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        const isContentValid = validateInput(postContent, postContentError, 'ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

        if (isTitleValid && isContentValid) {
            $.post('/community/add', { lectureId, postTitle: postTitle.val(), postContent: postContent.val() })
                .done(function(response) {
                    if (response === 'success') {
                        loadLectureCommunities();
                        postTitle.val('');
                        postContent.val('');
                    }
                })
                .fail(function(xhr) {
                    if (xhr.status === 403) {
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/login';
                    }
                });
        }
    });


    // ë…¸íŠ¸ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $(document).on('click', '.delete-note-button', function() {
        const noteId = $(this).data('note-id');
        $.post('/notes/delete', { noteId, lectureId }, function(response) {
            if (response === 'success') {
                loadNotes();
            }
        });
    });

    // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $(document).on('click', '.delete-community-button', function() {
        const postId = $(this).data('post-id');
        $.post('/community/delete', { postId }, function(response) {
            if (response === 'success') {
                loadLectureCommunities();
            }
        });
    });

    // ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
    initializePlayer();
});
</script>

</body>
</html>
